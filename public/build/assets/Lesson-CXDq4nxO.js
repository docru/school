import{v as n,_ as y,m as w,a as H}from"./app-1A470Pyi.js";import{b as I,C as _,P as $,p as h,g as L,M as b}from"./index-DZXbmRZO.js";const x={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},T=n.defineComponent({props:x,setup(l){return()=>{const{tocItem:c,mdHeadingId:u,scrollElement:s,onClick:d,scrollElementOffsetTop:p}=l;return n.createVNode("div",{class:[`${h}-catalog-link`,c.active&&`${h}-catalog-active`],onClick:a=>{d(a,c),a.stopPropagation();const f=u(c.text,c.level,c.index),i=document.getElementById(f),e=s instanceof Element?s:document.querySelector(s);if(i&&e){let t=i.offsetParent,o=i.offsetTop;if(e.contains(t))for(;t&&e!=t;)o+=t==null?void 0:t.offsetTop,t=t==null?void 0:t.offsetParent;e==null||e.scrollTo({top:o-p,behavior:"smooth"})}}},[n.createVNode("span",{title:c.text},[c.text]),n.createVNode("div",{class:`${h}-catalog-wrapper`},[c.children&&c.children.map(a=>n.createVNode(T,{mdHeadingId:u,key:`${c.text}-link-${a.level}-${a.text}`,tocItem:a,scrollElement:s,onClick:d,scrollElementOffsetTop:p},null))])])}}}),N=T,A={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:l=>l},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},C=n.defineComponent({name:"MdCatalog",props:A,emits:["onClick","onActive"],setup(l,c){const u=l.editorId,s=n.reactive({list:[],show:!1,scrollElement:l.scrollElement||`#${u}-preview-wrapper`}),d=n.shallowRef(),p=n.computed(()=>{const e=[];return s.list.forEach((t,o)=>{const{text:E,level:k}=t,r={level:k,text:E,index:o+1,active:d.value===t};if(e.length===0)e.push(r);else{let m=e[e.length-1];if(r.level>m.level)for(let v=m.level+1;v<=6;v++){const{children:g}=m;if(!g){m.children=[r];break}if(m=g[g.length-1],r.level<=m.level){g.push(r);break}}else e.push(r)}}),e}),a=()=>s.scrollElement instanceof HTMLElement?s.scrollElement:document.querySelector(s.scrollElement),f=e=>{if(e.length===0)return s.list=[],!1;const{activeHead:t}=e.reduce((o,E,k)=>{const r=document.getElementById(l.mdHeadingId(E.text,E.level,k+1));if(r instanceof HTMLElement){const m=a(),v=L(r,m);if(v<l.offsetTop&&v>o.minTop)return{activeHead:E,minTop:v}}return o},{activeHead:e[0],minTop:Number.MIN_SAFE_INTEGER});d.value=t,s.list=e},i=()=>{f(s.list)};return n.watch(()=>d.value,e=>{const t=e?{...e}:void 0;l.onActive?l.onActive(t):c.emit("onActive",t)}),n.onMounted(()=>{let e=window;const t=()=>{const o=a();e=o===document.documentElement?window:o};I.on(u,{name:_,callback:o=>{e==null||e.removeEventListener("scroll",i),f(o),t(),e==null||e.addEventListener("scroll",i)}}),I.emit(u,$),t(),e==null||e.addEventListener("scroll",i)}),n.onBeforeUnmount(()=>{var e;const t=a();(e=t===document.documentElement?window:t)==null||e.removeEventListener("scroll",i)}),()=>n.createVNode("div",{class:`${h}-catalog${l.theme==="dark"?"-dark":""} ${l.class}`},[p.value.map(e=>n.createVNode(N,{mdHeadingId:l.mdHeadingId,tocItem:e,key:`link-${e.level}-${e.text}`,scrollElement:s.scrollElement,onClick:(t,o)=>{l.onClick?l.onClick(t,o):c.emit("onClick",t,o)},scrollElementOffsetTop:l.scrollElementOffsetTop},null))])}});C.install=l=>(l.component(C.name,C),l);const O={name:"Lesson",data(){return{id:"preview-only",scrollElement:document.documentElement}},components:{MdCatalog:C,MdPreview:b},computed:{...w("disciple",{lesson:"getLesson"})},methods:{...H("disciple",["actRequestLesson"])},created(){this.actRequestLesson(this.$route.params)}},S={class:"tw-flex"};function M(l,c,u,s,d,p){var f,i;const a=n.resolveComponent("MdPreview");return n.openBlock(),n.createElementBlock("div",S,[n.createVNode(a,{editorId:d.id,modelValue:(i=(f=l.lesson)==null?void 0:f.lesson)==null?void 0:i.abstract},null,8,["editorId","modelValue"])])}const F=y(O,[["render",M]]);export{F as default};
