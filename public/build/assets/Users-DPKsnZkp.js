import{_ as k,b as y,a as x,m as N,v as e}from"./app-D83wlC67.js";import{I as b,L as U,C as B}from"./ICode-rrbXcgbd.js";import{I as R,a as E,b as I}from"./IMore-DC-Nu93q.js";const L={name:"Users",components:{IMore:R,IModeration:E,IVast:I,ICode:b,Loading:U,Code:B},data(){return{search:"",dialog:!1,surname:"",name:"",patronymic:"",phone:"",usersHeaders:[{title:"id",key:"id"},{title:"Вход",key:"entrance"},{title:"ФИО",key:"surname"},{title:"Роли",key:"roles"},{title:"Телефон",key:"phone"},{title:"Ссылка",sortable:!1,key:"link"},{title:"",align:"end",sortable:!1,key:"actions"}]}},methods:{create(){this.actUserCreate({surname:this.surname,name:this.name,patronymic:this.patronymic,phone:this.phone,roles:this.getRoles.filter(o=>o.value).map(o=>o.name)}).then(o=>{if(o){this.search=this.phone.replace(/^8/,7),this.surname="",this.name="",this.patronymic="",this.phone="";let s=this.getRoles();for(const c in s)s[c].value=!1;this.setRoles(s)}})},editItem(o){alert("Редактирование пользователя. Пока не сделано ((")},deleteItem(o){alert("Удаление пользователя. Пока не сделано ((")},...y("users",["setRoles"]),...x("users",["actReqwestUsers","actReqwestUserRoles","actUserCreate","actUserCreateLink"])},computed:{...N("users",["getUsers","getRoles","getLoad","getRolesSelect"]),searchItems(){var d;let o=this.getUsers,s=this.getRolesSelect.filter(l=>l.value).length,c=(d=this.getRolesSelect.filter(l=>l.value))==null?void 0:d.map(l=>l.name);return!this.search&&!s?this.getUsers:(this.search&&(o=this.getUsers.filter(l=>{var n,a;return((n=l.phone)==null?void 0:n.search(this.search))>-1||((a=l.surname)==null?void 0:a.search(this.search))>-1})),s&&(o=o.filter(l=>l.roles.map(a=>a.name).filter(a=>c.includes(a)).length)),o)},canCreate(){return!!this.getRoles.filter(o=>o.value).length&&!!this.phone&&!!this.surname&&!!this.name}},created(){this.actReqwestUsers(),this.actReqwestUserRoles()}},S={class:"tw-flex tw-flex-col tw-gap-[15px] tw-mb-5 tw-justify-center"},M={class:"tw-w-full tw-grid tw-gap-2 tw-grid-cols-1 md:tw-grid-cols-2 xl:tw-grid-cols-4"},T={class:"tw-w-full tw-grid tw-gap-2 tw-grid-cols-1 md:tw-grid-cols-2"},q={class:"tw-flex tw-flex-col md:tw-flex-row"},z={key:0},H={class:"tw-flex tw-flex-col md:tw-flex-row tw-justify-between"},D={class:"tw-w-full md:tw-w-1/3"},j={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},A={style:{float:"right"}},F=e.createElementVNode("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.59964 3.45737C3.80628 0.250428 8.08538 -0.94687 11.6901 0.811276C15.6603 2.74768 17.3091 7.53595 15.3727 11.5062C13.4363 15.4764 8.64798 17.1251 4.67776 15.1887C3.08138 14.4101 1.81733 13.1467 1.03718 11.5918C0.839085 11.197 0.998557 10.7163 1.39337 10.5182C1.78819 10.3201 2.26884 10.4796 2.46694 10.8744C3.09113 12.1184 4.10063 13.1275 5.379 13.751C8.55518 15.3001 12.3858 13.9811 13.9349 10.8049C15.484 7.62876 14.1651 3.79815 10.9889 2.24902C7.94449 0.764172 4.29884 1.91436 2.63736 4.80937H3.99909C4.44082 4.80937 4.79891 5.16746 4.79891 5.60918C4.79891 6.05091 4.44082 6.409 3.99909 6.409H0.799819C0.358091 6.409 0 6.05091 0 5.60918V2.40991C0 1.96818 0.358091 1.61009 0.799819 1.61009C1.24155 1.61009 1.59964 1.96818 1.59964 2.40991V3.45737Z",fill:"#B0BACD"},null,-1),G=[F],Z=["innerHTML"],J=["onClick"];function K(o,s,c,d,l,n){const a=e.resolveComponent("v-card-title"),i=e.resolveComponent("v-text-field"),m=e.resolveComponent("v-checkbox"),w=e.resolveComponent("v-btn"),p=e.resolveComponent("v-card-text"),u=e.resolveComponent("v-card"),_=e.resolveComponent("v-divider"),h=e.resolveComponent("v-icon"),C=e.resolveComponent("v-skeleton-loader"),v=e.resolveComponent("Code"),f=e.resolveComponent("v-chip"),V=e.resolveComponent("v-data-table"),g=e.resolveComponent("Loading");return o.getUsers&&o.getRoles?(e.openBlock(),e.createBlock(u,{key:0},{default:e.withCtx(()=>[e.createVNode(a,null,{default:e.withCtx(()=>[e.createTextVNode(" Пользователи ")]),_:1}),e.createVNode(p,null,{default:e.withCtx(()=>[e.createVNode(u,null,{default:e.withCtx(()=>[e.createVNode(p,null,{default:e.withCtx(()=>[e.createElementVNode("div",S,[e.createElementVNode("div",M,[e.createVNode(i,{label:"Фамилия",modelValue:l.surname,"onUpdate:modelValue":s[0]||(s[0]=t=>l.surname=t)},null,8,["modelValue"]),e.createVNode(i,{label:"Имя",modelValue:l.name,"onUpdate:modelValue":s[1]||(s[1]=t=>l.name=t)},null,8,["modelValue"]),e.createVNode(i,{label:"Отчество",modelValue:l.patronymic,"onUpdate:modelValue":s[2]||(s[2]=t=>l.patronymic=t)},null,8,["modelValue"]),e.createVNode(i,{label:"Телефон",type:"number",modelValue:l.phone,"onUpdate:modelValue":s[3]||(s[3]=t=>l.phone=t)},null,8,["modelValue"])]),e.createElementVNode("div",T,[e.createElementVNode("div",q,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.getRoles,t=>(e.openBlock(),e.createBlock(m,{"hide-details":"",top:"",density:"compact",modelValue:t.value,"onUpdate:modelValue":r=>t.value=r,label:t.display_name},null,8,["modelValue","onUpdate:modelValue","label"]))),256))]),o.getRoles?(e.openBlock(),e.createBlock(w,{key:0,class:"tw-mt-2",color:"primary",disabled:!n.canCreate,onClick:n.create},{default:e.withCtx(()=>[e.createTextVNode("Создать пользователя ")]),_:1},8,["disabled","onClick"])):e.createCommentVNode("",!0)])])]),_:1})]),_:1}),e.createVNode(_,{class:"tw-my-3",color:"blue"}),o.getUsers?(e.openBlock(),e.createElementBlock("div",z,[e.createElementVNode("div",H,[e.createElementVNode("div",D,[e.createVNode(i,{clearable:"","persistent-clear":"",label:"Поиск по фамилии/телефону",modelValue:l.search,"onUpdate:modelValue":s[4]||(s[4]=t=>l.search=t)},null,8,["modelValue"])]),e.createElementVNode("div",j,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.getRolesSelect,t=>(e.openBlock(),e.createBlock(m,{"hide-details":"",density:"compact",modelValue:t.value,"onUpdate:modelValue":r=>t.value=r,top:"",label:t.display_name},null,8,["modelValue","onUpdate:modelValue","label"]))),256))])]),e.createVNode(V,{"onClick:row":s[6]||(s[6]=t=>l.dialog=!l.dialog),headers:l.usersHeaders,items:n.searchItems,loading:o.getLoad},{"item.actions":e.withCtx(({item:t})=>[e.createVNode(h,{class:"me-2",size:"small",onClick:e.withModifiers(r=>n.editItem(t),["stop"])},{default:e.withCtx(()=>[e.createTextVNode("mdi-pencil")]),_:2},1032,["onClick"]),e.createVNode(h,{size:"small",onClick:e.withModifiers(r=>n.deleteItem(t),["stop"])},{default:e.withCtx(()=>[e.createTextVNode("mdi-delete")]),_:2},1032,["onClick"])]),"header.actions":e.withCtx(()=>[e.createElementVNode("div",A,[(e.openBlock(),e.createElementBlock("svg",{class:"tw-cursor-pointer",onClick:s[5]||(s[5]=e.withModifiers((...t)=>o.actReqwestUsers&&o.actReqwestUsers(...t),["stop"])),width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},G))])]),loading:e.withCtx(()=>[e.createVNode(C,{type:"table-row@10"})]),"item.roles":e.withCtx(({item:t})=>[e.createElementVNode("div",{innerHTML:t.roles.map(r=>r.display_name).join(", "),style:{"font-size":"12px"}},null,8,Z)]),"item.surname":e.withCtx(({item:t})=>[e.createTextVNode(e.toDisplayString(t.surname)+" "+e.toDisplayString(t.name)+" "+e.toDisplayString(t.patronymic),1)]),"item.link":e.withCtx(({item:t})=>[t.entry_code?(e.openBlock(),e.createBlock(v,{key:0,code:t.entry_code},null,8,["code"])):(e.openBlock(),e.createElementBlock("div",{key:1,onClick:r=>o.actUserCreateLink({uid:t.id})},"сгенерить ключ",8,J))]),"item.entrance":e.withCtx(({item:t})=>[e.createVNode(f,{color:t.authorized_at?"green":"grey"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.authorized_at?t.authorized_at:"не заходил"),1)]),_:2},1032,["color"])]),_:1},8,["headers","items","loading"])])):e.createCommentVNode("",!0)]),_:1})]),_:1})):(e.openBlock(),e.createBlock(g,{key:1}))}const W=k(L,[["render",K]]);export{W as default};
