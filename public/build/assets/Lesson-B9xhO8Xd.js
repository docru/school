import{v as n,_ as T,m as w,a as H}from"./app-D9ggA3vg.js";import{b as y,C as $,P as _,p as h,g as N,M as L}from"./index-BFTMMOPj.js";const b={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},I=n.defineComponent({props:b,setup(l){return()=>{const{tocItem:c,mdHeadingId:u,scrollElement:s,onClick:d,scrollElementOffsetTop:p}=l;return n.createVNode("div",{class:[`${h}-catalog-link`,c.active&&`${h}-catalog-active`],onClick:a=>{d(a,c),a.stopPropagation();const f=u(c.text,c.level,c.index),r=document.getElementById(f),e=s instanceof Element?s:document.querySelector(s);if(r&&e){let t=r.offsetParent,o=r.offsetTop;if(e.contains(t))for(;t&&e!=t;)o+=t==null?void 0:t.offsetTop,t=t==null?void 0:t.offsetParent;e==null||e.scrollTo({top:o-p,behavior:"smooth"})}}},[n.createVNode("span",{title:c.text},[c.text]),n.createVNode("div",{class:`${h}-catalog-wrapper`},[c.children&&c.children.map(a=>n.createVNode(I,{mdHeadingId:u,key:`${c.text}-link-${a.level}-${a.text}`,tocItem:a,scrollElement:s,onClick:d,scrollElementOffsetTop:p},null))])])}}}),x=I,A={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:l=>l},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},C=n.defineComponent({name:"MdCatalog",props:A,emits:["onClick","onActive"],setup(l,c){const u=l.editorId,s=n.reactive({list:[],show:!1,scrollElement:l.scrollElement||`#${u}-preview-wrapper`}),d=n.shallowRef(),p=n.computed(()=>{const e=[];return s.list.forEach((t,o)=>{const{text:E,level:k}=t,i={level:k,text:E,index:o+1,active:d.value===t};if(e.length===0)e.push(i);else{let m=e[e.length-1];if(i.level>m.level)for(let v=m.level+1;v<=6;v++){const{children:g}=m;if(!g){m.children=[i];break}if(m=g[g.length-1],i.level<=m.level){g.push(i);break}}else e.push(i)}}),e}),a=()=>s.scrollElement instanceof HTMLElement?s.scrollElement:document.querySelector(s.scrollElement),f=e=>{if(e.length===0)return s.list=[],!1;const{activeHead:t}=e.reduce((o,E,k)=>{const i=document.getElementById(l.mdHeadingId(E.text,E.level,k+1));if(i instanceof HTMLElement){const m=a(),v=N(i,m);if(v<l.offsetTop&&v>o.minTop)return{activeHead:E,minTop:v}}return o},{activeHead:e[0],minTop:Number.MIN_SAFE_INTEGER});d.value=t,s.list=e},r=()=>{f(s.list)};return n.watch(()=>d.value,e=>{const t=e?{...e}:void 0;l.onActive?l.onActive(t):c.emit("onActive",t)}),n.onMounted(()=>{let e=window;const t=()=>{const o=a();e=o===document.documentElement?window:o};y.on(u,{name:$,callback:o=>{e==null||e.removeEventListener("scroll",r),f(o),t(),e==null||e.addEventListener("scroll",r)}}),y.emit(u,_),t(),e==null||e.addEventListener("scroll",r)}),n.onBeforeUnmount(()=>{var e;const t=a();(e=t===document.documentElement?window:t)==null||e.removeEventListener("scroll",r)}),()=>n.createVNode("div",{class:`${h}-catalog${l.theme==="dark"?"-dark":""} ${l.class}`},[p.value.map(e=>n.createVNode(x,{mdHeadingId:l.mdHeadingId,tocItem:e,key:`link-${e.level}-${e.text}`,scrollElement:s.scrollElement,onClick:(t,o)=>{l.onClick?l.onClick(t,o):c.emit("onClick",t,o)},scrollElementOffsetTop:l.scrollElementOffsetTop},null))])}});C.install=l=>(l.component(C.name,C),l);const S={name:"Lesson",data(){return{id:"preview-only",scrollElement:document.documentElement}},components:{MdCatalog:C,MdPreview:L},computed:{...w("disciple",{lesson:"getLesson"})},methods:{...H("disciple",["actRequestLesson"])},created(){this.actRequestLesson(this.$route.params)}},O={class:"tw-flex"};function M(l,c,u,s,d,p){var f,r,e,t;const a=n.resolveComponent("MdPreview");return n.openBlock(),n.createElementBlock(n.Fragment,null,[n.createElementVNode("h1",null,n.toDisplayString((r=(f=l.lesson)==null?void 0:f.lesson)==null?void 0:r.name),1),n.createElementVNode("div",O,[n.createVNode(a,{editorId:d.id,modelValue:(t=(e=l.lesson)==null?void 0:e.lesson)==null?void 0:t.abstract},null,8,["editorId","modelValue"])])],64)}const F=T(S,[["render",M]]);export{F as default};
