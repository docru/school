import{_ as y,b as x,a as B,m as E,v as e}from"./app-D4g4NRDO.js";import{I as U,L as b,C as I}from"./ICode-DW8xAcp5.js";import{I as R,a as D,b as S}from"./IMore-CLWVCGpY.js";const T={name:"Users",components:{IMore:R,IModeration:D,IVast:S,ICode:U,Loading:b,Code:I},data(){return{currentItem:null,search:"",openEdit:!1,openDel:!1,dialog:!1,surname:"",name:"",patronymic:"",phone:"",usersHeaders:[{title:"id",key:"id"},{title:"Вход",key:"entrance"},{title:"ФИО",key:"surname"},{title:"Роли",key:"roles"},{title:"Телефон",key:"phone"},{title:"Ссылка",sortable:!1,key:"link"},{title:"",align:"end",sortable:!1,key:"actions"}]}},methods:{create(){this.actUserCreate({surname:this.surname,name:this.name,patronymic:this.patronymic,phone:this.phone,roles:this.getRoles.filter(o=>o.value).map(o=>o.name)}).then(o=>{if(o){this.search=this.phone.replace(/^8/,7),this.surname="",this.name="",this.patronymic="",this.phone="";let n=this.getRoles();for(const i in n)n[i].value=!1;this.setRoles(n)}})},deleteItem(o){this.actUserDelete(this.currentItem.id),this.openDel=!1,this.currentItem=null,this.actReqwestUsers()},openEditF(o){o!=null&&o.id?(this.openEdit=!0,this.currentItem={id:o.id,phone:o.phone||"",name:o.name||"",surname:o.surname||"",patronymic:o.patronymic||"",roles:o.roles||[]}):alert("Не определен пользователь")},closeEdit(){this.openEdit=!1,this.currentItem=null},async editUser(){await this.actUserSave(this.currentItem)!==!1&&(this.openEdit=!1,this.currentItem=null,await this.actReqwestUsers())},...x("users",["setRoles"]),...B("users",["actReqwestUsers","actReqwestUserRoles","actUserCreate","actUserCreateLink","actUserSave","actUserDelete"])},computed:{...E("users",["getUsers","getRoles","getLoad","getRolesSelect"]),searchItems(){var p;let o=this.getUsers,n=this.getRolesSelect.filter(l=>l.value).length,i=(p=this.getRolesSelect.filter(l=>l.value))==null?void 0:p.map(l=>l.name);return!this.search&&!n?this.getUsers:(this.search&&(o=this.getUsers.filter(l=>{var r,d;return((r=l.phone)==null?void 0:r.search(this.search))>-1||((d=l.surname)==null?void 0:d.search(this.search))>-1})),n&&(o=o.filter(l=>l.roles.map(d=>d.name).filter(d=>i.includes(d)).length)),o)},canCreate(){return!!this.getRoles.filter(o=>o.value).length&&!!this.phone&&!!this.surname&&!!this.name},editRoles:{get(){return this.currentItem.roles.map(o=>o.name)},set(o){let n=[];for(const i in this.getRoles)o.indexOf(this.getRoles[i].name)>-1&&n.push(this.getRoles[i]);this.currentItem.roles=n}}},created(){this.actReqwestUsers(),this.actReqwestUserRoles()}},L={class:"tw-flex tw-flex-col tw-gap-[15px] tw-mb-5 tw-justify-center"},M={class:"tw-w-full tw-grid tw-gap-2 tw-grid-cols-1 md:tw-grid-cols-2 xl:tw-grid-cols-4"},q={class:"tw-w-full tw-grid tw-gap-2 tw-grid-cols-1 md:tw-grid-cols-2"},z={class:"tw-flex tw-flex-col md:tw-flex-row"},F={class:"tw-flex tw-items-center tw-gap-2"},H={key:0},j={class:"tw-flex tw-flex-col md:tw-flex-row tw-justify-between"},A={class:"tw-w-full md:tw-w-1/3"},G={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},O={class:"tw-flex"},Z={style:{float:"right"}},J=e.createElementVNode("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.59964 3.45737C3.80628 0.250428 8.08538 -0.94687 11.6901 0.811276C15.6603 2.74768 17.3091 7.53595 15.3727 11.5062C13.4363 15.4764 8.64798 17.1251 4.67776 15.1887C3.08138 14.4101 1.81733 13.1467 1.03718 11.5918C0.839085 11.197 0.998557 10.7163 1.39337 10.5182C1.78819 10.3201 2.26884 10.4796 2.46694 10.8744C3.09113 12.1184 4.10063 13.1275 5.379 13.751C8.55518 15.3001 12.3858 13.9811 13.9349 10.8049C15.484 7.62876 14.1651 3.79815 10.9889 2.24902C7.94449 0.764172 4.29884 1.91436 2.63736 4.80937H3.99909C4.44082 4.80937 4.79891 5.16746 4.79891 5.60918C4.79891 6.05091 4.44082 6.409 3.99909 6.409H0.799819C0.358091 6.409 0 6.05091 0 5.60918V2.40991C0 1.96818 0.358091 1.61009 0.799819 1.61009C1.24155 1.61009 1.59964 1.96818 1.59964 2.40991V3.45737Z",fill:"#B0BACD"},null,-1),K=[J],P=["innerHTML"],Q=["onClick"],W={class:"tw-border tw-my-2 tw-rounded-md tw-border-[gray] tw-p-1 tw-w-[248px]"},X={class:"tw-text-[12px] tw-mx-[3px]"},Y={class:"tw-flex tw-justify-between"},$={key:0},ee={class:"tw-flex tw-justify-between"},te=e.createElementVNode("div",null,"Редактирование ученика",-1),le={key:0};function oe(o,n,i,p,l,r){const d=e.resolveComponent("v-card-title"),a=e.resolveComponent("v-text-field"),h=e.resolveComponent("v-checkbox"),c=e.resolveComponent("v-btn"),V=e.resolveComponent("v-card-text"),m=e.resolveComponent("v-card"),w=e.resolveComponent("v-divider"),u=e.resolveComponent("v-icon"),_=e.resolveComponent("v-skeleton-loader"),k=e.resolveComponent("Code"),v=e.resolveComponent("v-chip"),g=e.resolveComponent("v-data-table"),N=e.resolveComponent("Loading"),C=e.resolveComponent("v-dialog");return e.openBlock(),e.createElementBlock(e.Fragment,null,[o.getUsers&&o.getRoles?(e.openBlock(),e.createBlock(m,{key:0},{default:e.withCtx(()=>[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(" Пользователи ")]),_:1}),e.createVNode(V,null,{default:e.withCtx(()=>[e.createVNode(m,null,{default:e.withCtx(()=>[e.createVNode(V,null,{default:e.withCtx(()=>[e.createElementVNode("div",L,[e.createElementVNode("div",M,[e.createVNode(a,{label:"Фамилия",modelValue:l.surname,"onUpdate:modelValue":n[0]||(n[0]=t=>l.surname=t)},null,8,["modelValue"]),e.createVNode(a,{label:"Имя",modelValue:l.name,"onUpdate:modelValue":n[1]||(n[1]=t=>l.name=t)},null,8,["modelValue"]),e.createVNode(a,{label:"Отчество",modelValue:l.patronymic,"onUpdate:modelValue":n[2]||(n[2]=t=>l.patronymic=t)},null,8,["modelValue"]),e.createVNode(a,{label:"Телефон",type:"number",modelValue:l.phone,"onUpdate:modelValue":n[3]||(n[3]=t=>l.phone=t)},null,8,["modelValue"])]),e.createElementVNode("div",q,[e.createElementVNode("div",z,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.getRoles,t=>(e.openBlock(),e.createBlock(h,{"hide-details":"",top:"",density:"compact",modelValue:t.value,"onUpdate:modelValue":s=>t.value=s,label:t.display_name},null,8,["modelValue","onUpdate:modelValue","label"]))),256))]),e.createElementVNode("div",F,[o.getRoles?(e.openBlock(),e.createBlock(c,{key:0,class:"tw-mt-2",color:"primary",disabled:!r.canCreate,onClick:r.create},{default:e.withCtx(()=>[e.createTextVNode(" Создать пользователя ")]),_:1},8,["disabled","onClick"])):e.createCommentVNode("",!0)])])])]),_:1})]),_:1}),e.createVNode(w,{class:"tw-my-3",color:"blue"}),o.getUsers?(e.openBlock(),e.createElementBlock("div",H,[e.createElementVNode("div",j,[e.createElementVNode("div",A,[e.createVNode(a,{clearable:"","persistent-clear":"",label:"Поиск по фамилии/телефону",modelValue:l.search,"onUpdate:modelValue":n[4]||(n[4]=t=>l.search=t)},null,8,["modelValue"])]),e.createElementVNode("div",G,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.getRolesSelect,t=>(e.openBlock(),e.createBlock(h,{"hide-details":"",density:"compact",modelValue:t.value,"onUpdate:modelValue":s=>t.value=s,top:"",label:t.display_name},null,8,["modelValue","onUpdate:modelValue","label"]))),256))])]),e.createVNode(g,{"onClick:row":n[6]||(n[6]=t=>l.dialog=!l.dialog),headers:l.usersHeaders,items:r.searchItems,loading:o.getLoad},e.createSlots({"item.actions":e.withCtx(({item:t})=>[e.createElementVNode("div",O,[e.createVNode(u,{class:"me-2",size:"small",onClick:e.withModifiers(s=>r.openEditF(t),["stop"])},{default:e.withCtx(()=>[e.createTextVNode(" mdi-pencil ")]),_:2},1032,["onClick"]),t.deleted_at?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(u,{key:0,size:"small",onClick:e.withModifiers(s=>{l.openDel=!0,l.currentItem=t},["stop"])},{default:e.withCtx(()=>[e.createTextVNode(" mdi-delete ")]),_:2},1032,["onClick"]))])]),"header.actions":e.withCtx(()=>[e.createElementVNode("div",Z,[(e.openBlock(),e.createElementBlock("svg",{class:"tw-cursor-pointer",onClick:n[5]||(n[5]=e.withModifiers((...t)=>o.actReqwestUsers&&o.actReqwestUsers(...t),["stop"])),width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},K))])]),loading:e.withCtx(()=>[e.createVNode(_,{type:"table-row@10"})]),"item.roles":e.withCtx(({item:t})=>[e.createElementVNode("div",{innerHTML:t.roles.map(s=>s.display_name).join(", "),style:{"font-size":"12px"}},null,8,P)]),"item.surname":e.withCtx(({item:t})=>[e.createTextVNode(e.toDisplayString(t.surname)+" "+e.toDisplayString(t.name)+" "+e.toDisplayString(t.patronymic),1)]),"item.link":e.withCtx(({item:t})=>[t.deleted_at?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t.entry_code?(e.openBlock(),e.createBlock(k,{key:0,code:t.entry_code},null,8,["code"])):(e.openBlock(),e.createElementBlock("div",{key:1,onClick:s=>o.actUserCreateLink({uid:t.id})},"сгенерить ключ",8,Q))],64))]),"item.entrance":e.withCtx(({item:t})=>[t.deleted_at?(e.openBlock(),e.createBlock(v,{key:0},{default:e.withCtx(()=>[e.createTextVNode(" удален ")]),_:1})):(e.openBlock(),e.createBlock(v,{key:1,color:t.authorized_at?"green":"grey"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.authorized_at?t.authorized_at:"не заходил"),1)]),_:2},1032,["color"]))]),_:2},[o.$vuetify.display.name==="sm"?{name:"item",fn:e.withCtx(({item:t,columns:s})=>[e.createElementVNode("div",W,[e.createElementVNode("div",null,e.toDisplayString(t.name)+" "+e.toDisplayString(t.patronymic)+" "+e.toDisplayString(t.surname),1),e.createVNode(w),e.createElementVNode("div",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.roles,f=>(e.openBlock(),e.createElementBlock("div",X,e.toDisplayString(f.display_name),1))),256))]),e.createElementVNode("div",null,[t.entry_code?(e.openBlock(),e.createBlock(k,{key:0,code:t.entry_code},null,8,["code"])):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,[e.createVNode(c,{size:"small",color:"red",variant:"text",onClick:e.withModifiers(f=>{l.openDel=!0,l.currentItem=t},["stop"])},{default:e.withCtx(()=>[e.createTextVNode("Удалить ")]),_:2},1032,["onClick"]),e.createVNode(c,{size:"small",variant:"text"},{default:e.withCtx(()=>[e.createTextVNode("Редактировать")]),_:1})])])]),key:"0"}:void 0]),1032,["headers","items","loading"])])):e.createCommentVNode("",!0)]),_:1})]),_:1})):(e.openBlock(),e.createBlock(N,{key:1})),e.createVNode(C,{width:"300",modelValue:l.openDel,"onUpdate:modelValue":n[8]||(n[8]=t=>l.openDel=t)},{default:e.withCtx(()=>[e.createVNode(m,{elevation:"0",class:"tw-p-2"},{default:e.withCtx(()=>[e.createElementVNode("div",Y,[l.currentItem?(e.openBlock(),e.createElementBlock("div",$,"Вы точно хотите удалить ?")):e.createCommentVNode("",!0),e.createElementVNode("div",null,[e.createVNode(u,{onClick:n[7]||(n[7]=t=>{l.openDel=!1,l.currentItem=null})},{default:e.withCtx(()=>[e.createTextVNode("mdi-close")]),_:1})])]),e.createElementVNode("div",null,[e.createVNode(c,{color:"red",block:"",class:"tw-my-3",onClick:e.withModifiers(r.deleteItem,["stop"])},{default:e.withCtx(()=>[e.createTextVNode(" да ")]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue"]),e.createVNode(C,{width:"300",modelValue:l.openEdit,"onUpdate:modelValue":n[14]||(n[14]=t=>l.openEdit=t)},{default:e.withCtx(()=>[e.createVNode(m,{class:"tw-p-2"},{default:e.withCtx(()=>[e.createElementVNode("div",ee,[te,e.createElementVNode("div",null,[e.createVNode(u,{onClick:r.closeEdit},{default:e.withCtx(()=>[e.createTextVNode("mdi-close")]),_:1},8,["onClick"])])]),l.currentItem?(e.openBlock(),e.createElementBlock("div",le,[e.createVNode(a,{modelValue:l.currentItem.name,"onUpdate:modelValue":n[9]||(n[9]=t=>l.currentItem.name=t),label:"Имя"},null,8,["modelValue"]),e.createVNode(a,{modelValue:l.currentItem.surname,"onUpdate:modelValue":n[10]||(n[10]=t=>l.currentItem.surname=t),label:"Фамилия"},null,8,["modelValue"]),e.createVNode(a,{modelValue:l.currentItem.patronymic,"onUpdate:modelValue":n[11]||(n[11]=t=>l.currentItem.patronymic=t),label:"Отчество"},null,8,["modelValue"]),e.createVNode(a,{modelValue:l.currentItem.phone,"onUpdate:modelValue":n[12]||(n[12]=t=>l.currentItem.phone=t),label:"Телефон"},null,8,["modelValue"]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.getRoles,t=>(e.openBlock(),e.createBlock(h,{"hide-details":"",top:"",density:"compact",modelValue:r.editRoles,"onUpdate:modelValue":n[13]||(n[13]=s=>r.editRoles=s),value:t.name,label:t.display_name},null,8,["modelValue","value","label"]))),256)),e.createVNode(c,{block:"",onClick:e.withModifiers(r.editUser,["stop"])},{default:e.withCtx(()=>[e.createTextVNode("Сохранить")]),_:1},8,["onClick"])])):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["modelValue"])],64)}const ae=y(T,[["render",oe]]);export{ae as default};
