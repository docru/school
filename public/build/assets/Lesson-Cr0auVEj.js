import{v as n,_ as T,a as _,m as w}from"./app-Cb1AT_Gr.js";import{b as k,C as H,P as x,p as C,g as $,M as L}from"./index-BfAVFMX6.js";const N={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},y=n.defineComponent({props:N,setup(l){return()=>{const{tocItem:c,mdHeadingId:u,scrollElement:s,onClick:a,scrollElementOffsetTop:v}=l;return n.createVNode("div",{class:[`${C}-catalog-link`,c.active&&`${C}-catalog-active`],onClick:i=>{a(i,c),i.stopPropagation();const f=u(c.text,c.level,c.index),r=document.getElementById(f),e=s instanceof Element?s:document.querySelector(s);if(r&&e){let t=r.offsetParent,o=r.offsetTop;if(e.contains(t))for(;t&&e!=t;)o+=t==null?void 0:t.offsetTop,t=t==null?void 0:t.offsetParent;e==null||e.scrollTo({top:o-v,behavior:"smooth"})}}},[n.createVNode("span",{title:c.text},[c.text]),n.createVNode("div",{class:`${C}-catalog-wrapper`},[c.children&&c.children.map(i=>n.createVNode(y,{mdHeadingId:u,key:`${c.text}-link-${i.level}-${i.text}`,tocItem:i,scrollElement:s,onClick:a,scrollElementOffsetTop:v},null))])])}}}),b=y,A={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:l=>l},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},h=n.defineComponent({name:"MdCatalog",props:A,emits:["onClick","onActive"],setup(l,c){const u=l.editorId,s=n.reactive({list:[],show:!1,scrollElement:l.scrollElement||`#${u}-preview-wrapper`}),a=n.shallowRef(),v=n.computed(()=>{const e=[];return s.list.forEach((t,o)=>{const{text:E,level:I}=t,d={level:I,text:E,index:o+1,active:a.value===t};if(e.length===0)e.push(d);else{let m=e[e.length-1];if(d.level>m.level)for(let p=m.level+1;p<=6;p++){const{children:g}=m;if(!g){m.children=[d];break}if(m=g[g.length-1],d.level<=m.level){g.push(d);break}}else e.push(d)}}),e}),i=()=>s.scrollElement instanceof HTMLElement?s.scrollElement:document.querySelector(s.scrollElement),f=e=>{if(e.length===0)return s.list=[],!1;const{activeHead:t}=e.reduce((o,E,I)=>{const d=document.getElementById(l.mdHeadingId(E.text,E.level,I+1));if(d instanceof HTMLElement){const m=i(),p=$(d,m);if(p<l.offsetTop&&p>o.minTop)return{activeHead:E,minTop:p}}return o},{activeHead:e[0],minTop:Number.MIN_SAFE_INTEGER});a.value=t,s.list=e},r=()=>{f(s.list)};return n.watch(()=>a.value,e=>{const t=e?{...e}:void 0;l.onActive?l.onActive(t):c.emit("onActive",t)}),n.onMounted(()=>{let e=window;const t=()=>{const o=i();e=o===document.documentElement?window:o};k.on(u,{name:H,callback:o=>{e==null||e.removeEventListener("scroll",r),f(o),t(),e==null||e.addEventListener("scroll",r)}}),k.emit(u,x),t(),e==null||e.addEventListener("scroll",r)}),n.onBeforeUnmount(()=>{var e;const t=i();(e=t===document.documentElement?window:t)==null||e.removeEventListener("scroll",r)}),()=>n.createVNode("div",{class:`${C}-catalog${l.theme==="dark"?"-dark":""} ${l.class}`},[v.value.map(e=>n.createVNode(b,{mdHeadingId:l.mdHeadingId,tocItem:e,key:`link-${e.level}-${e.text}`,scrollElement:s.scrollElement,onClick:(t,o)=>{l.onClick?l.onClick(t,o):c.emit("onClick",t,o)},scrollElementOffsetTop:l.scrollElementOffsetTop},null))])}});h.install=l=>(l.component(h.name,h),l);const M={name:"Lesson",data(){return{id:"preview-only",scrollElement:document.documentElement}},components:{MdCatalog:h,MdPreview:L},computed:{..._("disciple",{lesson:"getLesson"})},methods:{...w("disciple",["actRequestLesson"])},created(){this.actRequestLesson(this.$route.params)}},O={class:"tw-flex"};function S(l,c,u,s,a,v){var r,e;const i=n.resolveComponent("MdCatalog"),f=n.resolveComponent("MdPreview");return n.openBlock(),n.createElementBlock("div",O,[n.createVNode(i,{editorId:a.id,scrollElement:a.scrollElement,style:{position:"fixed"}},null,8,["editorId","scrollElement"]),n.createVNode(f,{style:{"margin-left":"100px"},editorId:a.id,modelValue:(e=(r=l.lesson)==null?void 0:r.lesson)==null?void 0:e.abstract},null,8,["editorId","modelValue"])])}const F=T(M,[["render",S]]);export{F as default};
